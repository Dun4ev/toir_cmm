# Скрипт `toir_cmm.py`

**Ссылка на репозиторий: [github.com/Dun4ev/toir_cmm](https://github.com/Dun4ev/toir_cmm)**

## 1. Назначение

Скрипт предназначен для автоматического создания "Листа комментариев" (Comment Sheet) в формате `.xlsx` для выбранных файлов отчетов (например, `.docx` или `.pdf`).

Он использует шаблон `CommentSheet_Template.xltx` и автоматически заполняет в нем поля на основе имени файла-отчета и данных из справочника `TZ.xlsx`.

## 2. Принцип работы

1.  Пользователь запускает скрипт.
2.  Открывается диалоговое окно для выбора папки.
3.  Пользователь выбирает папку, содержащую файлы отчетов.
4.  Скрипт рекурсивно ищет все файлы `.docx` и `.pdf` в этой папке.
5.  Для каждого найденного файла, имя которого начинается с `CT-DR-`, он:
    - Создает копию из шаблона `CommentSheet_Template.xltx`.
    - Присваивает новому файлу имя вида `[имя_файла_отчета]_CMM.xlsx`.
    - Заполняет поля в новом файле: имя отчета, дата создания.
    - Извлекает из имени файла индекс (например, `I.7.4`), ищет его в `TZ.xlsx` и подставляет найденное описание в соответствующее поле.

## 3. Требования и структура проекта

- **Python**: Версия 3.8 или новее.
- **Библиотеки**: `openpyxl` (`pip install openpyxl`).
- **Структура папок**: Скрипт должен находиться в своей папке, внутри которой есть папка `Template` с необходимыми файлами.

  ```
  .../toir_cmm/
  ├── toir_cmm.py              # Сам скрипт
  ├── toir_cmm.md              # Этот файл
  └── Template/
      ├── TZ.xlsx              # Файл-справочник с индексами
      └── CommentSheet_Template.xltx # Шаблон для листа комментариев
  ```

## 4. Использование

- Запустите скрипт (`python toir_cmm.py`).
- В появившемся окне выберите папку с вашими отчетами.
- Дождитесь завершения обработки. Новые `_CMM.xlsx` файлы появятся рядом с исходными отчетами.

## 5. Сборка в .exe

При создании исполнительного файла (`.exe`) с помощью **PyInstaller** или аналогичного инструмента, необходимо включить в состав дистрибутива папку `Template` со всеми её файлами.

Это нужно для того, чтобы приложение могло найти шаблоны и справочники при запуске из `exe`-файла. В коде должна быть логика для корректного определения путей к этим файлам в упакованном приложении.

**Пример для PyInstaller:**

Чтобы добавить папку `Template` как данные, используйте флаг `--add-data`. Путь указывается в формате `ИСТОЧНИК;НАЗНАЧЕНИЕ_ВНУТРИ_EXE`.

```bash
# Пример команды для сборки
pyinstaller --onefile --windowed --add-data "Template;Template" toir_cmm.py
```

Или можно прописать это в `.spec` файле:

```python
# В файле toir_cmm.spec
a = Analysis(...)
a.datas += [('Template', 'Template', 'DATA')]
```